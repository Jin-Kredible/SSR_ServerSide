<?xml version="1.0" encoding="UTF-8"?>
<!-- 
	insertSavings : 포인트 행 추가(최초 추가)
	updateSavings : 포인트 전환
	firstSavings : 오늘 포인트 데이터가 있는지 일자 조회
	selectAllSavings : 총포인트 조회
	changedSavings : 포인트로 전환한 걸음수 (WALKS - WK_SA 수정)
-->
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sinc.ssr.mybatis.savings">
    <insert id="insertSavings" parameterType="savingsVO">
    	INSERT INTO SAVINGS(SA_ID, USER_ID, SA_DT, SA_AM)
		VALUES (SEQID_SA.NEXTVAL, #{user_id}, SYSDATE, DEFAULT);
    </insert>
    
    <update id="updateSavings" parameterType="savingsVO">
    	UPDATE 	SAVINGS
		SET 	SA_AM = #{sa_am}
					+ (SELECT SA_AM 
						FROM 	SAVINGS 
						WHERE 	USER_ID = #{user_id} 
						AND 	TO_CHAR(SA_DT, 'RRRR-MM-DD') = TO_CHAR(SYSDATE, 'RRRR-MM-DD'))
		WHERE 	USER_ID = #{user_id}
		AND 	TO_CHAR(SA_DT, 'RRRR-MM-DD') = TO_CHAR(SYSDATE, 'RRRR-MM-DD')
    </update>
  
     <select id="firstSavings" parameterType="savingsVO" resultType="string">
        SELECT 	TRUNC(SA_DT) 
        FROM 	SAVINGS 
        WHERE 	USER_ID = #{user_id} 
        AND 	TRUNC(SYSDATE) IN TRUNC(SA_DT)
    </select>
       
    <select id="selectAllSavings" parameterType="savingsVO" resultType="int">
    	SELECT 	SA_AM
    	FROM 	SAVINGS
    	WHERE 	USER_ID = #{user_id}
    </select>
    
    <update id="changedSavings" parameterType="savingsVO">
    	UPDATE 	WALKS
    	SET 	WK_SA =	#{sa_am}*100 
    				+ (SELECT 	WK_SA 
						FROM 	WALKS
						WHERE 	USER_ID = #{user_id}
						AND 	TO_CHAR(WK_DT, 'RRRR-MM-DD') = TO_CHAR(SYSDATE, 'RRRR-MM-DD'))
		WHERE 	USER_ID = #{user_id}
		AND 	TO_CHAR(WK_DT, 'RRRR-MM-DD') = TO_CHAR(SYSDATE, 'RRRR-MM-DD')
    </update>       
    

</mapper>